# v0.4.0-beta1 – 2025-11-08

Diese Vorabversion fokussiert auf einen gehärteten, reproduzierbaren Build der ArgoCD-Init-Container-Image inklusive SBOM-Generierung, Vulnerability-Scan und automatisierten Tests in GitHub Actions.

## Highlights

- Multi-Arch Build (linux/amd64, linux/arm64) mit OCI-Export (.tar)
- SBOM-Erzeugung (Syft): CycloneDX und SPDX – als Build-Artefakte
- Vulnerability-Scan (Grype) – JSON-Bericht als Build-Artefakt
- Automatisierte Smoke-/Functional-Tests und BATS-Tests
- Entfernt: instabiles goss-Testing aus der Pipeline

## Änderungen im Detail

- CI-Workflow `build-argocdinit.yml` überarbeitet:
  - Entfernt goss-Container-Setup/-Tests
  - Ergänzt Security-Scan-Phase (Syft/Grype) und Artefakt-Uploads
  - Build exportiert ein Multi-Arch OCI-Tar (`<commit>.tar`)
  - Getrennte Single-Platform Test-Builds für schnellere Smoke-/Functional-Tests
  - BATS-Tests prüfen Binärpräsenz und helm-secrets Plugin
- Testverbesserungen:
  - `run-tests.sh`: kubectl Versionsausgabe ohne `--short` (robuster), SOPS/AGE Roundtrip, `helm template`-Smoke
- Gehardete/Pinning der Toolchain im Image (Alpine 3.22.2):
  - sops v3.10.2
  - kubectl v1.34.1
  - helm v3.18.0
  - vals v0.41.2
  - age v1.2.1
  - yq v4.48.1
  - argocd-vault-plugin v1.18.1
  - helm-secrets v4.6.11
  - Nicht-Root User (UID/GID 1001)

## Artefakte

Die Pipeline lädt folgende Artefakte hoch:

- `argocdinit-sbom-<commit>.zip` mit
  - `<commit>-sbom-cyclonedx.json`
  - `<commit>-sbom-spdx.json`
  - `<commit>-vuln.json`
- `argocdinit-image-<commit>.zip` mit
  - `<commit>.tar` (OCI-Multi-Arch Export des Images)

Hinweis: `<commit>` entspricht der Kurz-SHA des Builds. Für reproduzierbare Nachvollziehbarkeit werden alle Versionen der Werkzeuge im Dockerfile fest fixiert.

## Upgrade-Hinweise

- Keine Breaking Changes erwartet. Image kann wie bisher verwendet werden.
- Optional: OCI-Export kann lokal via `docker load -i <commit>.tar` eingespielt werden.

## Sicherheit

- SBOM und Vulnerability-Report werden erzeugt und als Artefakte bereitgestellt. Aktuell erfolgt kein automatisches Fail-on-Severity. Bei Bedarf kann das in einem Folge-Release aktiviert werden.
