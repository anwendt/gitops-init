# v0.4.0-beta1 – 2025-11-08

This prerelease focuses on a hardened, reproducible build of the ArgoCD init container image, including SBOM generation, vulnerability scanning, and automated tests in GitHub Actions.

## Highlights

- Multi-arch build (linux/amd64, linux/arm64) with OCI export (.tar)
- SBOM generation (Syft): CycloneDX and SPDX — uploaded as build artifacts
- Vulnerability scanning (Grype) — JSON report as a build artifact
- Automated smoke/functional tests and BATS tests
- Removed the unstable goss testing from the pipeline

## Changes in detail

- CI workflow `build-argocdinit.yml` reworked:
  - Removed goss container setup/tests
  - Added a security-scan stage (Syft/Grype) and artifact uploads
  - Build exports a multi-arch OCI tar (`<commit>.tar`)
  - Separate single-platform test builds for faster smoke/functional tests
  - BATS tests verify binary presence and the helm-secrets plugin
- Test improvements:
  - `run-tests.sh`: kubectl version output without `--short` (more robust), SOPS/AGE roundtrip, and a `helm template` smoke test
- Hardened/pinned toolchain in the image (Alpine 3.22.2):
  - sops v3.10.2
  - kubectl v1.34.1
  - helm v3.18.0
  - vals v0.41.2
  - age v1.2.1
  - yq v4.48.1
  - argocd-vault-plugin v1.18.1
  - helm-secrets v4.6.11
  - Non-root user (UID/GID 1001)

## Artifacts

The pipeline uploads the following artifacts:

- `argocdinit-sbom-<commit>.zip` containing
  - `<commit>-sbom-cyclonedx.json`
  - `<commit>-sbom-spdx.json`
  - `<commit>-vuln.json`
- `argocdinit-image-<commit>.zip` containing
  - `<commit>.tar` (OCI multi-arch export of the image)

Note: `<commit>` is the short SHA of the build. All tool versions are pinned in the Dockerfile for reproducibility.

## Upgrade notes

- No breaking changes expected. You can continue to use the image as before.
- Optional: Load the OCI export locally via `docker load -i <commit>.tar`.

## Security

- SBOM and vulnerability report are generated and uploaded as artifacts. Currently, the pipeline does not fail on severity thresholds. This can be enabled in a subsequent release if desired.
